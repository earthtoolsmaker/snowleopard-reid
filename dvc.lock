schema: '2.0'
stages:
  reorganize_locations:
    cmd: uv run python scripts/data/reorganize_locations.py --input-dir 
      data/01_raw/locations --output-dir data/02_processed/locations 
      --config-dir data/02_processed/config
    deps:
    - path: data/01_raw/locations
      hash: md5
      md5: edba822bc576a007bfae675441ad4b56.dir
      size: 2887614689
      nfiles: 1315
    - path: data/02_processed/config/naryn/individuals.yaml
      hash: md5
      md5: 14868258fbcbc109256dc105357f9cd6
      size: 261
    - path: data/02_processed/config/naryn/mappings.yaml
      hash: md5
      md5: e49a170cf13814fcd616a03021aefb85
      size: 330
    - path: data/02_processed/config/sarychat/individuals.yaml
      hash: md5
      md5: 125eff4a1ad2befd7c48a64b0d9299fe
      size: 553
    - path: data/02_processed/config/sarychat/mappings.yaml
      hash: md5
      md5: 8a2adbbb8b46a78e096fad652963ac98
      size: 884
    - path: scripts/data/reorganize_locations.py
      hash: md5
      md5: 5ea198f09c96c54dc9c391f1b9ba7dcc
      size: 14960
    outs:
    - path: data/02_processed/locations
      hash: md5
      md5: 082552e9df22ae9e4786d9b65be68ea0.dir
      size: 1936317980
      nfiles: 909
  grounding_dino_detection:
    cmd: uv run python scripts/models/grounding_dino.py --input-dir 
      data/02_processed/locations --output-dir 
      data/05_model_output/grounding_dino --text-prompt "a snow leopard." 
      --model-id IDEA-Research/grounding-dino-base --box-threshold 0.30 
      --text-threshold 0.20
    deps:
    - path: data/02_processed/locations
      hash: md5
      md5: 082552e9df22ae9e4786d9b65be68ea0.dir
      size: 1936317980
      nfiles: 909
    - path: scripts/models/grounding_dino.py
      hash: md5
      md5: 5424263ead9d5765cefa17ca3336ce96
      size: 15400
    outs:
    - path: data/05_model_output/grounding_dino
      hash: md5
      md5: 49e4b24a348f63bc7a93a9832d5f9de6.dir
      size: 310549219
      nfiles: 1816
  sam_hq_segmentation:
    cmd: uv run python scripts/models/sam_hq.py --input-dir 
      data/02_processed/locations --predictions-dir 
      data/05_model_output/grounding_dino/predictions --output-dir 
      data/05_model_output/sam_hq --checkpoint 
      data/04_models/SAM_HQ/sam_hq_vit_l.pth --model-type vit_l
    deps:
    - path: data/02_processed/locations
      hash: md5
      md5: 082552e9df22ae9e4786d9b65be68ea0.dir
      size: 1936317980
      nfiles: 909
    - path: data/04_models/SAM_HQ/sam_hq_vit_l.pth
      hash: md5
      md5: 08947267966e4264fb39523eccc33f86
      size: 1254865805
    - path: data/05_model_output/grounding_dino
      hash: md5
      md5: 49e4b24a348f63bc7a93a9832d5f9de6.dir
      size: 310549219
      nfiles: 1816
    - path: scripts/models/sam_hq.py
      hash: md5
      md5: d434be67c9fd2774623e4d557186e936
      size: 16531
    outs:
    - path: data/05_model_output/sam_hq
      hash: md5
      md5: 0733a9d015aaa6f5e717969df6e874c4.dir
      size: 320102750
      nfiles: 2753
  crop_masks:
    cmd: uv run python scripts/data/crop_leopard_masks.py --sam-output-dir 
      data/05_model_output/sam_hq --output-dir 
      data/02_processed/cropped/leopards --padding 10
    deps:
    - path: data/05_model_output/sam_hq
      hash: md5
      md5: 0733a9d015aaa6f5e717969df6e874c4.dir
      size: 320102750
      nfiles: 2753
    - path: scripts/data/crop_leopard_masks.py
      hash: md5
      md5: ff7ab3b01b1003062b09750dda67817e
      size: 7054
    outs:
    - path: data/02_processed/cropped/leopards
      hash: md5
      md5: d4444cdb7522271639b33213f4e1537a.dir
      size: 235758260
      nfiles: 934
  build_catalog:
    cmd: uv run python scripts/catalog/build_catalog_from_selection.py 
      --selection-file data/08_catalog/v1.0/selection.yaml --catalog-dir 
      data/08_catalog/v1.0/database && uv run python 
      scripts/catalog/extract_catalog_features.py --catalog-dir 
      data/08_catalog/v1.0/database --extractor sift --max-keypoints 2048 && uv 
      run python scripts/catalog/generate_catalog_metadata.py --catalog-dir 
      data/08_catalog/v1.0 --catalog-version 1.0.0
    deps:
    - path: data/02_processed/cropped/leopards
      hash: md5
      md5: d4444cdb7522271639b33213f4e1537a.dir
      size: 235758260
      nfiles: 934
    - path: data/08_catalog/v1.0/selection.yaml
      hash: md5
      md5: e6b92e5f9dbf6cf4e505d514a0b3a402
      size: 7074
    - path: scripts/catalog/build_catalog_from_selection.py
      hash: md5
      md5: 37702f81370f9bcb37b0f34d779c4012
      size: 4170
    - path: scripts/catalog/extract_catalog_features.py
      hash: md5
      md5: 81d85f1146a3da3563d23bb6cbfdcb7c
      size: 7771
    - path: scripts/catalog/generate_catalog_metadata.py
      hash: md5
      md5: 4ff64b39859e8d4d2153828ee508870a
      size: 13063
    outs:
    - path: data/08_catalog/v1.0/catalog_index.yaml
      hash: md5
      md5: 34f59154e2ad5d2c4abe10696bed639e
      size: 1415
    - path: data/08_catalog/v1.0/database
      hash: md5
      md5: 9339fc250bbad69970d82698ac3d88ee.dir
      size: 93461606
      nfiles: 149
